â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª TESTE FINAL - SISTEMA VERSÃƒO 1.2.1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INSTRUÃ‡Ã•ES:
1. Aguarde 90 segundos (deploy do Edge Function)
2. Abra console do navegador (F12)
3. Cole o cÃ³digo abaixo
4. Pressione ENTER
5. Me envie print do resultado

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const B='https://rqgubpqniscyoojkwltn.supabase.co/functions/v1/make-server-2d5da22b';
const T='Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJxZ3VicHFuaXNjeW9vamt3bHRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNzQxOTIsImV4cCI6MjA3NTk1MDE5Mn0.hQkPC_Z9RBEwlGHZBpWw6hMIVxfre2UVOKRhVOvsJ9o';

console.clear();
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('ğŸ§ª TESTE FINAL - SISTEMA v1.2.1');
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

// Teste 1: Endpoint raiz (novo)
console.log('ğŸ” TESTE 1: Endpoint raiz /pnboia\n');
fetch(B+'/pnboia',{headers:{Authorization:T}})
.then(r=>{
  console.log('   HTTP',r.status,r.ok?'âœ…':'âŒ');
  if(!r.ok){console.log('   âš ï¸ Deploy ainda nÃ£o chegou. Aguarde mais 1min.\n');throw new Error('404');}
  return r.json();
})
.then(d=>{
  console.log('   VersÃ£o:',d.version);
  console.log('   Endpoints:',d.endpoints.length,'\n');
  
  // Teste 2: Status das boias
  console.log('ğŸ” TESTE 2: Status das boias /pnboia/status\n');
  return fetch(B+'/pnboia/status',{headers:{Authorization:T}});
})
.then(r=>{
  console.log('   HTTP',r.status,r.ok?'âœ…':'âŒ');
  if(!r.ok)throw new Error('Status 404');
  return r.json();
})
.then(d=>{
  console.log('   Boias ativas:',d.active+'/'+d.total);
  console.log('   Ãšltima sync:',d.lastGlobalSync||'NUNCA');
  
  if(d.active===0){
    console.log('   âš ï¸ Sem dados. Iniciando sync...\n');
    return fetch(B+'/pnboia/sync-all',{method:'POST',headers:{Authorization:T}});
  }
  return null;
})
.then(r=>{
  if(r){
    console.log('ğŸ” TESTE 3: SincronizaÃ§Ã£o manual\n');
    console.log('   HTTP',r.status,r.ok?'âœ…':'âŒ');
    return r.json();
  }
  return null;
})
.then(d=>{
  if(d){
    console.log('   Sync iniciada. Boias:',d.total);
    console.log('   Sucesso:',d.success);
    console.log('   Falhas:',d.failed);
    console.log('\n   â³ Aguarde 30s e recarregue a pÃ¡gina.\n');
  }else{
    console.log('\n   âœ… Sistema jÃ¡ tem dados!\n');
  }
  
  // Teste 4: Dados formatados
  console.log('ğŸ” TESTE 4: Dados formatados /pnboia/data\n');
  return fetch(B+'/pnboia/data',{headers:{Authorization:T}});
})
.then(r=>{
  console.log('   HTTP',r.status,r.ok?'âœ…':'âŒ');
  if(!r.ok)return null;
  return r.json();
})
.then(d=>{
  if(d&&d.buoys){
    const active=d.buoys.filter(b=>b.hasData).length;
    console.log('   Boias com dados:',active);
    if(active>0){
      const first=d.buoys.find(b=>b.hasData);
      console.log('   Exemplo:',first.name);
      console.log('   - Altura:',first.waveHeight,'m');
      console.log('   - PerÃ­odo:',first.wavePeriod,'s');
    }
  }
  
  console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ“Š RESULTADO FINAL');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
  
  if(d&&d.buoys&&d.buoys.some(b=>b.hasData)){
    console.log('ğŸ‰ SISTEMA FUNCIONANDO PERFEITAMENTE!');
    console.log('');
    console.log('PrÃ³ximos passos:');
    console.log('1. Recarregue a pÃ¡gina (Ctrl+R)');
    console.log('2. Navegue atÃ© um pico');
    console.log('3. Veja o indicador PNBOIA no card de condiÃ§Ãµes');
    console.log('');
  }else{
    console.log('âš ï¸ Sistema OK, mas sem dados das boias ainda.');
    console.log('');
    console.log('PrÃ³ximos passos:');
    console.log('1. Aguarde 30 segundos');
    console.log('2. Recarregue a pÃ¡gina (Ctrl+R)');
    console.log('3. Se ainda sem dados, rode este teste novamente');
    console.log('');
  }
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
})
.catch(e=>{
  console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('âŒ ERRO');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
  console.error('Mensagem:',e.message);
  console.log('');
  if(e.message.includes('404')){
    console.log('Causa: Deploy do Edge Function ainda nÃ£o chegou');
    console.log('SoluÃ§Ã£o: Aguarde mais 1-2 minutos e rode novamente');
  }else{
    console.log('Causa: Cold start ou erro inesperado');
    console.log('SoluÃ§Ã£o: Aguarde 30s e rode novamente');
  }
  console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
});

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
